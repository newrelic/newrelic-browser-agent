<!DOCTYPE html>
<!--
  Copyright 2025 New Relic Corporation.
  PDX-License-Identifier: Apache-2.0
-->
<html lang="en">
  <head>
    <title>RUM - Dead Clicks</title>
    {init} {config}
    <script>
      NREUM.init.harvest.interval = 5
        // disable cookies to help e2e test events are wrapped in generic events instrument phase
      NREUM.init.privacy.cookies_enabled = false
      localStorage.clear()
    </script>
    {loader}
    <script>
      const doNothingFn = function() { console.log('This will never be logged.') }
      let clickCount = 0;

      function updateClickCount(elemId) {
        console.log('Custom event handler called.');
        clickCount++;
        document.getElementById(elemId).textContent = ''+clickCount;
      }
    </script>
    <style>
      a {
        color: blue;
        cursor: pointer;
        text-decoration: underline;
      }
      .non-interactive-element {
        color: red;
      }
    </style>
  </head>
  <body>
    <span id="dummy-span"></span> <!-- another element for e2e to click -->
    <div id="test-area">
      <h1 id="examples-home">RUM - Dead Clicks</h1>
      <p>This page is used to test dead clicks instrumentation.</p>
      Go to <a href="#does-not-exist">Dummy</a>, <a id="go-to-buttons" href="#examples-buttons">Buttons</a>, <a href="#examples-input-buttons">Input buttons</a>, <a href="#examples-links">Links</a>, <a href="#examples-textboxes">Textboxes</a>, <a href="#examples-others">Other Elements</a>
      <h2 id="examples-buttons">Buttons</h2>
      <a href="#examples-home">Back to top</a>
      <div>
        <p><strong>Click count: <span id="numBtnClicks"></span></strong></p>
        <p>Button with a click event handler, added via `addEventListener`.
          <button id="test-button-with-listener">Click Me</button>
          <script>
            document.getElementById('test-button-with-listener').addEventListener('click', () => { updateClickCount('numBtnClicks')});
          </script>
        </p>

        <p>Button with a click event handler, added via `onclick`.
          <button id="test-button-with-onclick" onclick="updateClickCount('numBtnClicks')">Click Me</button>
        </p>

        <p>Button that has a click event handler added, then removed.
          <button id="do-nothing-button">Do nothing</button>
          <script>
            document.getElementById("do-nothing-button").addEventListener("click", doNothingFn)
            document.getElementById("do-nothing-button").removeEventListener("click", doNothingFn)
          </script>
        </p>

        <p>Button with no click handler, no forms
          <button id="dead-button">Dead button</button>
        </p>

        <p>Button with listener + span child
          <button id="button-with-listener-and-span-child">
            <span id="span-inside-button-with-listener">Button</span>
          </button>
          <script>
            document.getElementById('button-with-listener-and-span-child').addEventListener('click', () => { updateClickCount('numBtnClicks')});
          </script>
        </p>

        <p>Dead button +  span child =>
          <button id="dead-button-with-span-child">
            <span id="span-inside-dead-button">Dead button</span>
          </button>
        </p>

        <p>Send XHR =>
          <button id="button-send-xhr" onclick="
            const xhr = new XMLHttpRequest();
            xhr.open('GET', '/json')
            xhr.send();
          "> Send XHR </button>
        </p>

        <p>Fetch =>
          <button id="button-fetch" onclick="fetch('/json')">Fetch!</button>
        </p>

        <fieldset>
          <legend>Buttons and forms</legend>
          <p>Button with a form ancestor
            <form id="form-with-button-child">
              <input type="checkbox" id="bar1" name="foo" value="bar1" checked />
              <label for="bar1">bar</label>
              <button id="button-with-form-ancestor">Button w/ form ancestor</button>
            </form>
          </p>

          <p>Button with a related form
            <form id="form-with-related-button">
              <input type="checkbox" id="bar2" name="foo" value="bar2" checked />
              <label for="bar2">bar</label>
            </form>
            <button id="button-with-related-form" form="form-with-related-button">Button w/ related form</button>
          </p>

          <p>Button with an invalid form
            <form id="form-with-no-valid-button">
              <input type="checkbox" id="bar3" name="foo" value="bar3" checked />
              <label for="bar3">bar</label>
              <button id="button-with-invalid-form" form="does-not-exist">Button w/ non-existent form</button>
            </form>
          </p>
        </fieldset>

        <fieldset>
          <legend>Buttons and popovers</legend>
          <p>Button for a popover
            <button id="button-for-popover" popovertarget="popover-target">Toggle popover</button> <!-- default action is "toggle" -->
            <button id="button-for-popover-hide" popovertarget="popover-target" popovertargetaction="hide">Hide popover</button>
            <button id="button-for-popover-show" popovertarget="popover-target" popovertargetaction="show">Show popover</button>
            <div id="popover-target" popover>This is a popover! </div>
          </p>

          <p>Button for an invalid popover
            <button id="button-for-popover-invalid-target" popovertarget="does-not-exist">Button for non-existent popover</button>
            <button id="button-for-popover-invalid-command" popovertarget="popover-target" popovertargetaction="foo">Button, popovertargetaction = foo</button>
          </p>
        </fieldset>

        <fieldset>
        <legend>Buttons and commands</legend>
          <p>Button as a command for a dialog
            <button id="button-for-show-modal-command" commandfor="sample-dialog" command="show-modal">Show modal</button>
            <button id="button-for-close-already-closed-modal" commandfor="sample-dialog" command="close">Close modal</button> <!-- this will do nothing -->
            <button id="button-for-request-close-already-closed-modal" commandfor="sample-dialog" command="request-close">Request to close modal</button> <!-- this will do nothing -->
            <button id="button-for-bad-dialog" commandfor="does-not-exist" command="show-modal">Show non-existent modal</button> <!-- this will do nothing -->
            <dialog id="sample-dialog" style="border: 1px solid #666; background-color: #ccc;">This is a dialog modal!
              <p>
                <button id="button-for-show-modal-again-command" commandfor="sample-dialog" command="show-modal">Show modal</button> <!-- this will do nothing -->
                <button id="button-for-close-command" commandfor="sample-dialog" command="close">Close modal</button>
                <button id="button-for-request-close-command" commandfor="sample-dialog" command="request-close">Request to close modal</button>
                <button id="button-for-bad-command" commandfor="sample-dialog" command="do-nothing">Do nothing</button>
              </p>
            </dialog>
          </p>
        </fieldset>

      </div>

      <h2 id="examples-input-buttons">Input, type = "button"</h2>
      <a href="#examples-home">Back to top</a>
      <div>
        <p><strong>Click count: <span id="numInputBtnClicks"></span></strong></p>
        <p>Button with a click event handler, added via `addEventListener`.
          <input type="button" id="test-input-button-with-listener" value="Click Me"/>
          <script>
            document.getElementById('test-input-button-with-listener').addEventListener('click', () => { updateClickCount('numInputBtnClicks')});
          </script>
        </p>

        <p>Button with a click event handler, added via `onclick`.
          <input type="button" id="test-input-button-with-onclick" onclick="updateClickCount('numInputBtnClicks')"value = "Click Me"/>
        </p>

        <p>Button that has a click event handler added, then removed.
          <input type="button" id="do-nothing-input-button" value="Do nothing"/>
          <script>
            document.getElementById("do-nothing-input-button").addEventListener("click", doNothingFn)
            document.getElementById("do-nothing-input-button").removeEventListener("click", doNothingFn)
          </script>
        </p>

        <p>Button with no click handler, no forms
          <input type="button" id="dead-input-button" value="Dead input button" />
        </p>
      </div>

      <h2 id="examples-links">Links</h2>
      <a href="#examples-home">Back to top</a>
      <div>
        <p><strong>Click count: <span id="numLinkClicks"></span></strong></p>
        <p>Link with a click event handler, added via `addEventListener`=>
          <a id="test-link-with-listener">Link</a>
          <script>
            document.getElementById('test-link-with-listener').addEventListener('click', () => {
              updateClickCount('numLinkClicks');
            })
          </script>
        </p>

        <p>Link with a click event handler, added via `onclick` =>
          <a id="test-link-with-onclick" onclick="updateClickCount('numLinkClicks')">Link</a>
        </p>

        <p>Link that has a click event handler added, then removed. =>
          <a id="do-nothing-link">Link</a>
          <script>
            document.getElementById("do-nothing-link").addEventListener("click", doNothingFn)
            document.getElementById("do-nothing-link").removeEventListener("click", doNothingFn)
          </script>
        </p>

        <p>Link with href =>
          <a id="test-link-with-href" href="https://www.example.com">Go to Example.com</a>
        </p>

        <p>Link with handler that updates window location
          <a id="test-link-updates-window-location">Change window location</a>
          <script>
            document.getElementById('test-link-updates-window-location').addEventListener('click', (e) => {
              e.preventDefault();
              window.location.href = 'https://www.example.com';
            })
          </script>
        </p>

        <p>Link with delayed navigation =>
          <a id="test-link-with-delayed-nav">Delayed navigation</a>
          <script>
            document.getElementById('test-link-with-delayed-nav').addEventListener('click', (e) => {
              e.preventDefault();
              setTimeout(() => {
                window.location.href = 'https://www.example.com';
              }, 3000);
            })
          </script>
        </p>

        <p>Link that goes back in history
          <a id="test-link-goes-back-in-history">Go back in history</a>
          <script>
            document.getElementById('test-link-goes-back-in-history').addEventListener('click', (e) => {
              e.preventDefault();
              window.history.back();
            })
          </script>
        </p>

        <p>Link that goes forward in history
          <a id="test-link-goes-forward-in-history">Go forward in history</a>
          <script>
            document.getElementById('test-link-goes-forward-in-history').addEventListener('click', (e) => {
              e.preventDefault();
              window.history.forward();
            })
          </script>
        </p>

        <p>Link invokes history.pushState
          <a id="test-link-history-pushstate">Push state</a>
          <script>
            document.getElementById('test-link-history-pushstate').addEventListener('click', (e) => {
              e.preventDefault();
              window.history.pushState({}, '', window.location.pathname + '#' + Math.random());
            })
          </script>
        </p>

        <p>Link invokes history.replaceState
          <a id="test-link-history-replacestate">Replace state</a>
          <script>
            document.getElementById('test-link-history-replacestate').addEventListener('click', (e) => {
              e.preventDefault();
              window.history.replaceState({}, '', window.location.pathname + '#' + Math.random());
            })
          </script>
        </p>

        <p>Dead link => <a id="dead-link">Link</a>
        </p>

        <p>Link with a click event handler +  span child =>
          <a id="link-with-listener-and-span-child">
            <span id="span-inside-link-with-listener">Link</span>
          </a>
          <script>
            document.getElementById('link-with-listener-and-span-child').addEventListener('click', () => {
              updateClickCount('numLinkClicks')
            });
          </script>
        </p>
        <p>Dead link +  span child =>
          <a id="dead-link-with-span-child">
            <span id="span-inside-dead-link">Link</span>
          </a>
        </p>

        <p>Send XHR =>
          <a id="link-send-xhr" onclick="
            const xhr = new XMLHttpRequest();
            xhr.open('GET', '/json')
            xhr.send();
          "> Send XHR </a>
        </p>

        <p>Fetch =>
          <a id="link-fetch" onclick="fetch('/json')">Fetch!</a>
        </p>
      </div>

      <h2 id="examples-textboxes">Textboxes</h2>
      <a href="#examples-home">Back to top</a>
      <div>
        <p>
          <label for="normal-textbox">Normal textbox =></label>
          <input type="text" id="normal-textbox" name="normal-textbox" value="Normal Textbox"/>
        </p>
        <p>
          <label for="readonly-textbox">Readonly textbox =></label>
          <input type="text" id="readonly-textbox" name="readonly-textbox" value="Readonly Textbox" readonly/>
        </p>
      </div>

      <h2 id="examples-others">Other Elements</h2>
      <a href="#examples-home">Back to top</a>
      <div>
        <p><strong>Click count: <span id="numSpanClicks"></span></strong></p>
        <p>Span with a click event handler, added via `addEventListener` =>
          <span id="span-with-listener" class="non-interactive-element">Span</span>
          <script>
            document.getElementById("span-with-listener").addEventListener('click', () => {
              updateClickCount('numSpanClicks');
            })
          </script>
        </p>
        <p>Span with a click event handler, added via `onclick` =>
          <span id="span-with-onclick" onclick="updateClickCount('numSpanClicks')" class="non-interactive-element">Span </span>
        </p>
        <p>Span with no handlers =>
          <span id="do-nothing-span" class="non-interactive-element">Span</span>
        </p>
      </div>
    </div>
  </body>
</html>
