<!DOCTYPE html>
<!--
  Copyright 2020 New Relic Corporation.
  PDX-License-Identifier: Apache-2.0
-->
<html>
  <head>
    <title>RUM Unit Test</title>
    {init}
    {config}
    <script>
      NREUM.init.harvest.interval = 30
      NREUM.init.logging.enabled = false
    </script>
    {loader}
  </head>
  <body>
    <div>This page fires an XHR and calls pushState when clicked</div>
    <script type="text/javascript">
    document.addEventListener('click', function () {
      var xhr = new XMLHttpRequest()
      xhr.open('POST', '/echo')
      xhr.send('123')

      setTimeout(function myTimeoutHandler(){
          slowFn(1000000000)
          throw new Error("I am an error")
          return "yay"
        }, 1000)

      xhr.addEventListener('load', function () {
        slowFn(1000000000) // AJAX 1 CB TIME

        a = new Promise((resolve, reject) => {
          slowFn(1000000000) // AJAX 1 PROMISE TIME
          setTimeout(() => {
            resolve()
          }, 10000)
        })
      }, true)

      function slowFn(loops){
          i = 0
          while(i < loops){
            i++
          }
        }

      window.location.hash = Math.random()
    }, false)
    </script>
  </body>
</html>