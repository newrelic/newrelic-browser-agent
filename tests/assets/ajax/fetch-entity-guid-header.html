<!DOCTYPE html>
<html>
<head>
  <title>Fetch - Entity GUID</title>
  {init} {config} {loader}
</head>
<body>
<div>
  This page initiates a fetch with a NR entity guid header.
</div>
<script>
  // Give entity guid as header in furst argument of fetch (Request class)
  window.app1 = newrelic.register({
    licenseKey: NREUM.info.licenseKey,
    applicationID: 1, // first arg case reports to app 1
  })
  
  window.app1.metadata.connected
    .then(({metadata}) => {
      const request = new Request('/json', {
        headers: {
          'X-Newrelic-Entity-Guid': metadata.target.entityGuid
        }
      })
      fetch(request)
    }).catch((err) => {
      newrelic.noticeError(err)
    })

  // Give entity guid as header in second argument of fetch
  window.app2 = newrelic.register({
    licenseKey: NREUM.info.licenseKey,
    applicationID: 2, // second arg case reports to app 2
  })
  
  window.app2.metadata.connected
    .then(({metadata}) => {
      fetch('/json', {
        headers: {
          'X-Newrelic-Entity-Guid': metadata.target.entityGuid
        }
      })
    })
    .catch((err) => {
      newrelic.noticeError(err)
    })
</script>
</body>
</html>
